<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QuickShare</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="container">
  <h1>ðŸš€ QuickShare</h1>

  <div class="card-grid">

    <div class="card">
      <h2>ðŸ“¤ Send Files</h2>
      <input type="file" id="file" multiple>

      <div class="progress-box">
        <div id="progress-bar"></div>
      </div>
      <p id="progress-text"></p>

      <button onclick="upload()">Upload</button>
      <div id="result"></div>
    </div>

    <div class="card">
      <h2>ðŸ“¥ Receive Files</h2>
      <input type="text" id="code" placeholder="Enter 6-digit code">
      <button onclick="downloadFile()">Download File</button>
      <p id="download-status"></p>
    </div>

  </div>

  <p class="footer">Files available for 1 hour Â· Max size 100MB</p>
</div>

<div class="credit">Developed by Dibyendu</div>

<script>
function upload() {
  let files = document.getElementById("file").files;
  if (!files.length) return alert("Select file(s)");

  let form = new FormData();
  for (let f of files) form.append("files", f);

  let xhr = new XMLHttpRequest();
  xhr.open("POST", "/upload", true);

  xhr.upload.onprogress = e => {
    if (e.lengthComputable) {
      let p = Math.round((e.loaded / e.total) * 100);
      document.getElementById("progress-bar").style.width = p + "%";
      document.getElementById("progress-text").innerText = p + "% uploaded";
    }
  };

  xhr.onload = () => {
    let d = JSON.parse(xhr.responseText);
    document.getElementById("result").innerHTML = `
      <p><b>Files:</b> ${d.files}</p>
      <p><b>Code:</b> ${d.code}</p>
      <button class="copy-btn" onclick="copyLink('${d.link}')">Copy Download Link</button>
      <p id="copy-status"></p>
      <img src="${d.qr}" class="qr">
    `;
  };

  xhr.send(form);
}

function copyLink(link) {
  navigator.clipboard.writeText(link);
  document.getElementById("copy-status").innerText = "âœ… Link copied";
}

function downloadFile() {
  let code = document.getElementById("code").value;
  fetch("/getfile", {
    method: "POST",
    headers: {"Content-Type":"application/x-www-form-urlencoded"},
    body: "code=" + code
  })
  .then(r => r.json())
  .then(d => {
    if (d.error) {
      document.getElementById("download-status").innerText = d.error;
    } else {
      window.location.href = d.link;
    }
  });
}
</script>

</body>
</html>
